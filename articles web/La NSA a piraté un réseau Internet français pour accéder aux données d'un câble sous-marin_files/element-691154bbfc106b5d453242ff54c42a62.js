/**
 * Package www/element
 * lmd/module/element/bootstrap
 * lmd/module/element/toolbar
 * lmd/ui/form/compteur-input
 * hgn/www/partials/element/toolbar.html.mu.js@abs
 * lmd/module/element/reaction
 * lmd/module/auth/mini-login
 * hgn/www/partials/auth/mini-login.html.mu.js@abs
 * lmd/ui/lecture-zen
 */

/* -- start module lmd/module/element/bootstrap -- */
define("lmd/module/element/bootstrap",function(require){var $=require("jquery"),toolbar=require("lmd/module/element/toolbar"),reaction=require("lmd/module/element/reaction"),facebook=require("lmd/core/social/facebook"),context=require("lmd/core/context"),bootstrap={init:function(params){params.toolbar.context=context;toolbar.init(params.toolbar);$("#articleBody").find("figcaption").each(function(){$(this).text($(this).data("caption"))});$("span#publisher").text($("span#publisher").data("source"));
$(".illustration_haut").hover(function(){$("figcaption",this).stop(true,true).slideDown("fast")},function(){$("figcaption",this).stop(true,true).slideUp("fast")});if(typeof params.facebook==="undefined")params.facebook={};lmd.onload(function(){facebook.load().done(function(){facebook.parse(params.facebook)})})}};return bootstrap});

/* -- end module lmd/module/element/bootstrap -- */
/* -- start module lmd/module/element/toolbar -- */
define("lmd/module/element/toolbar",["jquery","lmd/core/conf","lmd/core/social/facebook","lmd/core/auth","lmd/module/auth/mini-login","lib/jquery/plugin/jquery.spin","hoganpower!/partials/element/toolbar.html.mu"],function($,conf,facebook,auth,login,jQuerySpin,template){return{_renderDeferred:null,$el:null,_options:null,render:function(){if(this._renderDeferred===null){this._renderDeferred=$.Deferred();auth.loadUser().done($.proxy(function(){this.$el=$(template.render());this._initMiniLogin();this._initSharing();this._initEnvoyer();
this._initImprimer();this._initClasser();this._initReagir();this._initAbonnezVous();this._renderDeferred.resolve()},this))}return this._renderDeferred.promise()},_initMiniLogin:function(){if(auth.authenticated&&auth.user&&auth.user.abonne)return;this.$el.find(".mini-login").spin({width:270,height:250});this.$el.find(".mini-login").data().spinBlock.css("float","right");var $el=this.$el;login.render();if($(".toolbar .mini-login").length>0)$el=$(".toolbar");$el.find(".mini-login").parent().find(".spin-block").hide();
$el.find(".mini-login").show();$el.find(".mini-login").append(login.$el)},_initSharing:function(partage){var k=this,link;this.$el.find(".partage .facebook").click(function(event){k._xt_click(event.currentTarget,"Partage_Facebook");link=partage||k._getPageUrl("",false);facebook.load().done(function(){FB.ui({method:"feed",link:link,picture:""})})});this.$el.find(".partage .twitter").click(function(event){k._xt_click(event.currentTarget,"Partage_Twitter");link=partage||k._getPageUrl("AL-32280258",true);
var text=$("<div />").html(k._options.context.item.titre).text();var url="http://twitter.com/share?related=lemondefr&via=lemondefr&lang=fr&text="+encodeURIComponent(text)+"&url="+link,params={};params.width=550;params.height=280;k._openPopupShare(url,params)});this.$el.find(".partage .linkedin").click(function(event){k._xt_click(event.currentTarget,"Partage_LinkedIn");link=partage||k._getPageUrl("AL-32280506",true);var url="http://www.linkedin.com/shareArticle?mini=true&url="+link+"&title="+encodeURIComponent(k._options.context.item.titre)+
"&source=LeMonde.fr",params={};params.width=550;params.height=340;k._openPopupShare(url,params)});this.$el.find(".partage .google-plus").click(function(event){k._xt_click(event.currentTarget,"Partage_Google+");link=partage||k._getPageUrl("",true);var url="https://plus.google.com/share?hl=fr&url="+link,params={};params.width=600;params.height=600;k._openPopupShare(url,params)});this.$el.find(".partage .pinterest").click(function(event){k._xt_click(event.currentTarget,"Partage_Pinterest");link=partage||
k._getPageUrl("",true);var url="https://www.pinterest.com/pin/create/button/?url="+link+"&description="+encodeURIComponent(k._options.context.item.titre);media=$("meta[property='og:image']").attr("content");if(typeof media!=="undefined"&&media!==null)url=url+"&media="+media;var params={};params.width=750;params.height=330;k._openPopupShare(url,params)})},_openPopupShare:function(url,params){var width=typeof params.width!=="undefined"?params.width:650,height=typeof params.height!=="undefined"?params.height:
430,left=($(window).width()-width)/2,top=($(window).height()-height)/2,paramsOpen="";paramsOpen="width="+width+",height="+height+",top="+top+",left="+left;paramsOpen+=",location=no,resizable=yes,status=no,titlebar=no,toolbar=no";window.open(url,"toolbar_share_popup",paramsOpen)},_xt_click:function(elmt,str_xt_click,type,position){if(typeof type==="undefined")type="A";if(typeof xt_click==="function")xt_click(elmt,"C",this._options.context.page.xiti.xtn2,str_xt_click,type);return false},_getPosition:function(toolbar){var index=
$(".toolbar").index($(toolbar)),strTop="Top",strBottom="Bottom";switch(index){case 0:return strTop;case 1:return strBottom}return strTop},_initEnvoyer:function(){if(typeof this._options.envoyer==="undefined"||typeof this._options.envoyer.active!=="undefined"&&this._options.envoyer.active===false){this.$el.find(".outil_envoyer").hide();return}var k=this;this.$el.find(".outil_envoyer").on("click",function(event){k._xt_click(event.currentTarget,"Clic_Envoyer");window.open(k._options.envoyer.link,"_blank")})},
_initImprimer:function(){if(typeof this._options.imprimer==="undefined"||typeof this._options.imprimer.active!=="undefined"&&this._options.imprimer.active===false){this.$el.find(".outil_imprimer").hide();return}var k=this;this.$el.find(".outil_imprimer").click(function(event){k._xt_click(event.currentTarget,"Clic_Imprimez");window.print()})},_initClasser:function(){if(typeof this._options.classer!=="undefined"&&typeof this._options.classer.active!=="undefined"&&this._options.classer.active===false){this.$el.find(".outil.classer").hide();
return}if(auth.authenticated&&auth.user&&auth.user.abonne)this._checkFav();this.$el.find(".outil.classer").click($.proxy(this._onClickClasser,this));this.$el.find(".confirmation .fermer").click(function(){$(this).parents(".confirmation").hide()})},_onClickClasser:function(event){var toolbar=$(event.currentTarget).parents(".toolbar");this._xt_click(event.currentTarget,"Clic_Classer");if(!auth.authenticated||!auth.user||!auth.user.abonne){if(toolbar.find(".teaser .non_abo.classer").is(":visible"))toolbar.find(".teaser").hide();
else toolbar.find(".teaser").show();toolbar.find(".teaser .non_abo").hide();toolbar.find(".teaser .non_abo.classer").show();return}this._toggleFav(toolbar)},_checkFav:function(){var url="/api/1/user/classer/$1/$2/$3.html",user_id=auth.user.id+"",k=this;url=url.replace("$1",user_id[user_id.length-1]);url=url.replace("$2",user_id[user_id.length-2]);url=url.replace("$3",user_id);$.get(url,null,null,"json").done(function(data){if(typeof data==="undefined"||!data)return;var i;for(i=0;i<data.ids.length;i++)if(k._options.context.item.id===
data.ids[i]){$(".toolbar .outil.classer").addClass("actif");return}})},_toggleFav:function(toolbar){toolbar.find(".confirmation").hide();this._callToggleFavApi();var alltoolbar=$(".toolbar");if(alltoolbar.find(".outil.classer").hasClass("actif")){alltoolbar.find(".outil.classer").removeClass("actif");toolbar.find(".confirmation .message").html("Cet \u00e9l\u00e9ment a bien \u00e9t\u00e9 supprim\u00e9 de votre classeur.").show()}else{alltoolbar.find(".outil.classer").addClass("actif");toolbar.find(".confirmation .message").html("Cet \u00e9l\u00e9ment a bien \u00e9t\u00e9 ajout\u00e9 \u00e0 votre classeur.").show();
require(["lmd/core/advert/ezakus"],function(ezakus){ezakus.trigger("classer")})}toolbar.find(".confirmation").show()},_callToggleFavApi:function(){var data={},jsonParams;data.mode="add_elem";data.item_id=this._options.context.item.id;jsonParams="params="+JSON.stringify(data);$.get("/api/1/user/classeur/",jsonParams,null,"json").done($.proxy(auth.refresh,auth))},_initReagir:function(){if(typeof this._options.reagir!=="undefined"&&typeof this._options.reagir.active!=="undefined"&&this._options.reagir.active===
false){this.$el.find(".outil.reagir").hide();return}this.$el.find(".outil.reagir").on("click",$.proxy(this._onClickReagir,this))},_onClickReagir:function(event){var toolbar=$(event.currentTarget).parents(".toolbar");this._xt_click(event.currentTarget,"Clic_Reagir");if(typeof this._options.reagir!=="undefined"&&typeof this._options.reagir.link!=="undefined")window.open(this._options.reagir.link,"_blank");else if(!auth.authenticated||!auth.user||!auth.user.abonne){if(toolbar.find(".teaser .non_abo.reagir").is(":visible"))toolbar.find(".teaser").hide();
else toolbar.find(".teaser").show();toolbar.find(".teaser .non_abo").hide();toolbar.find(".teaser .non_abo.reagir").show();return false}},_initAbonnezVous:function(){if(typeof this._options.abonnez_vous!=="undefined"&&typeof this._options.abonnez_vous.active!=="undefined"&&this._options.abonnez_vous.active===false)return;if(!auth.authenticated||!auth.user||!auth.user.abonne){this.$el.find(".barre_outils .bt_abo").show();var k=this;this.$el.find(".barre_outils .bt_abo, .teaser .btn_abo").click(function(event){k._xt_click(event.currentTarget,
"Clic_Abonnement","N");window.open("http://"+conf.www.location.hostname+"/abo/?clef=BTN_OUTILS14","_blank")})}},_getPageUrl:function(xtor,urlencode){var hostname=conf.www.location.hostname;if(typeof this._options.sharing!=="undefined"&&typeof this._options.sharing.use_current_location!=="undefined"&&this._options.sharing.use_current_location===true)hostname=window.location.hostname;var url="http://"+hostname+this._options.context.page.link;if(typeof xtor==="string"&&xtor!=="")url+="#xtor="+xtor;if(typeof urlencode===
"boolean")if(urlencode===false)return url;return encodeURI(url)},parse:function(selector){selector=selector||"body";$(selector).find(".toolbar").unspin().append(this.$el).show()},_addSpin:function(){$(".toolbar").spin({height:30,width:534,spRadius:5,spWidth:2,spLength:3,spLines:12})},init:function(options){this._options=options;this.render().done($.proxy(this.parse,this))}}});

/* -- end module lmd/module/element/toolbar -- */
/* -- start module lmd/ui/form/compteur-input -- */
define("lmd/ui/form/compteur-input",["jquery"],function($){return{init:function($textarea,$compteur){var limit=$textarea.attr("maxlength"),size=$textarea.val().length,left=limit-size;$textarea.keyup(function(){size=$(this).val().length;if(limit>0){left=limit-size>0?limit-size:0;$(this).val($(this).val().substring(0,limit))}var str_compteur=left;str_compteur+=left>1?" caract\u00e8res restants":" caract\u00e8re restant";$compteur.html(str_compteur)}).keyup()}}});

/* -- end module lmd/ui/form/compteur-input -- */
/* -- start module hgn/www/partials/element/toolbar.html.mu.js@abs -- */
define("hgn/www/partials/element/toolbar.html.mu.js@abs",function(){return function(c,p,i){var _=this;_.b(i=i||"");_.b("<div class=\"conteneur_barre_outils\">");_.b("\n" + i);_.b("   <div class=\"barre_outils\">");_.b("\n" + i);_.b("      <span class=\"bt_abo txt11\" style=\"display:none\">Abonnez-vous<br>à partir de 1 &euro;</span>");_.b("\n" + i);_.b("      <a class=\"reagir outil\" href=\"#liste_reactions\"><span></span> Réagir</a>");_.b("\n" + i);_.b("      <span class=\"classer outil\"><span></span> Classer</span>");_.b("\n" + i);_.b("      <span class=\"outil_imprimer outil\" title=\"Imprimer\"><span class=\"imprimer\"></span></span>");_.b("\n" + i);_.b("      <span class=\"outil_envoyer outil\" title=\"Envoyer\"><span class=\"envoyer\"></span></span>");_.b("\n" + i);_.b("      <p class=\"partage\">");_.b("\n" + i);_.b("         <span>Partager</span>");_.b("\n" + i);_.b("         <span class=\"facebook fb13x13\">facebook</span>");_.b("\n" + i);_.b("         <span class=\"twitter tw13x13\">twitter</span>");_.b("\n" + i);_.b("         <span class=\"google-plus google13x13\">google +</span>");_.b("\n" + i);_.b("         <span class=\"linkedin linkedin13x13\">linkedin</span>");_.b("\n" + i);_.b("         <span class=\"pinterest pinterest13x13\">pinterest</span>");_.b("\n" + i);_.b("      </p>");_.b("\n" + i);_.b("   </div>");_.b("\n" + i);_.b("   <p class=\"confirmation\" style=\"display:none\"><span class=\"message\"></span><span class=\"fermer\">fermer</span></p>");_.b("\n" + i);_.b("   <div class=\"teaser clearfix reaction_identifier\" style=\"display:none\">");_.b("\n" + i);_.b("      <div class=\"non_abo reagir\" style=\"display:none\">");_.b("\n" + i);_.b("         <span class=\"txt18\">Réagir</span>");_.b("\n" + i);_.b("         <p class=\"tt24_capital txt_reagir clearfix\"><span class=\"agauche\">D'accord,<br>pas d'accord ? </span><span class=\"bg\"></span></p>");_.b("\n" + i);_.b("         <p class=\"texte\">Pour réagir, abonnez-vous au Monde.fr <strong><br/>&agrave; partir de 1 &euro;</strong>");_.b("\n" + i);_.b("         </p>");_.b("\n" + i);_.b("         <a href=\"#\" onclick=\"return xt_click(this, 'C', lmd.context.page.xiti.xtn2, 'Clic_Abonnement','N');\" class=\"btn_abo\">Abonnez-vous</a>");_.b("\n" + i);_.b("      </div>");_.b("\n" + i);_.b("      <div class=\"non_abo classer\" style=\"display:none\">");_.b("\n" + i);_.b("         <span class=\"txt18\">Classer</span>");_.b("\n" + i);_.b("         <p class=\"tt24_capital txt_classer clearfix\"><span class=\"agauche\">Pas le temps de<br>lire cet article ?</span><span class=\"bg\"></span></p>");_.b("\n" + i);_.b("         <p class=\"texte\">Conservez-le pour le consulter plus tard. Abonnez-vous au Monde.fr <strong><br/>&agrave; partir de 1 &euro;</strong>");_.b("\n" + i);_.b("         </p>");_.b("\n" + i);_.b("         <a onclick=\"return xt_click(this, 'C', lmd.context.page.xiti.xtn2, 'Clic_Abonnement','N');\" href=\"#\" class=\"btn_abo\">Abonnez-vous</a>");_.b("\n" + i);_.b("      </div>");_.b("\n" + i);_.b("      <div class=\"mini-login\">");_.b("\n" + i);_.b("      </div>");_.b("\n" + i);_.b("   </div>");_.b("\n" + i);_.b("</div>");_.b("\n");return _.fl();;}})
/* -- end module hgn/www/partials/element/toolbar.html.mu.js@abs -- */
/* -- start module lmd/module/element/reaction -- */
define("lmd/module/element/reaction",["jquery","lmd/core/auth","lmd/core/conf","lmd/core/context","lib/jquery/plugin/jquery.prettydate","lmd/ui/form/compteur-input"],function($,auth,conf,context,pretty_date,compteur_input){var reaction={_initDeferred:null,element_id:null,$root:null,$localForm:null,$globalForm:null,num_reaction:null,limit_reaction:3,signature:null,init:function(selector,element_id){var closure=this;this.element_id=element_id;this.$root=$(selector||"this");$("[data-date-iso]",closure.$root).prettyDate({interval:3E4});
if(this._initDeferred===null){this._initDeferred=$.Deferred();auth.loadUser().done(function(){if(auth.authenticated)if(auth.user.abonne){$(".reaction_identifier",this.$root).remove();closure.signature=auth.user.prenom+" "+auth.user.nom;closure._getUserInfo().done(function(){closure._initForm();closure._initReagir();closure._initRepondre();closure._initDeferred.resolve()})}else closure._hideReaction();else{$(".reaction_redaction",this.$root).remove();closure._initForm();closure._initReagir();closure._initRepondre();
closure._initAbonnezVous();closure._initDeferred.resolve()}})}return this._initDeferred.promise()},_getUserInfo:function(){var closure=this;var userDef=$.Deferred();$.getJSON("/ws/1/reaction/information/",{item_id:this.element_id},"jsonp").done(function(response){if(response.error!==true)closure.num_reaction=response.nb_user}).then(function(){userDef.resolve()});return userDef.promise()},_initForm:function(){if(this.num_reaction>=this.limit_reaction){this._hideReaction();return}if(this.$globalForm===
null&&$(".reaction_identifier,.reaction_redaction",this.$root).filter(":first").length>0){this.$globalForm=$(".reaction_identifier,.reaction_redaction",this.$root).filter(":first");this.$localForm=this.$globalForm.clone(true,true);this._initFormLogin();this._initFormReaction();this.$localForm.find("[name=reponse]").val(1)}$(".formReaction").css("display","block");$(".bt_repondre, .bt_repondre .btn",this.$root).css("visibility","auto");$(".bt_reagir").css("visibility","visible")},_initFormLogin:function(){var closure=
this,$form=this.$globalForm.add(this.$localForm);$(".deja_abo",$form).on("submit",function(event){event.preventDefault();event.stopPropagation();var data=$(this).serialize(),form=this;auth.login(data,true).done(function(response){if(!response.result){$(".erreur",form).show();return}else auth.loadUser().done(function(){document.location.reload()})})});$(".password_recover",$form).on("click",function(event){event.preventDefault();event.stopPropagation();$(".trigger_boite_login").click();$("#password_recover").click()});
$form.filter(".reaction_identifier").each(function(){})},_hideReaction:function(){$(".reaction_identifier,.reaction_redaction",this.$root).remove();$(".bt_repondre, .bt_repondre .btn",this.$root).css("visibility","hidden");$(".bt_reagir",this.$root).css("visibility","hidden")},_initFormReaction:function(){var closure=this,$form=this.$globalForm.add(this.$localForm);$(".infobulle",this.$root).removeClass("infobulle");$form.filter(".reaction_redaction").each(function(){compteur_input.init($("textarea",
this),$(".annotation",this));var form=this;closure.afficherNbRestant(this,".num_reaction",closure.num_reaction+1);$("[name=signature]").data("default",closure.signature).val(closure.signature);$(this).on("submit",function(event){event.preventDefault();event.stopPropagation();var data=$(this).serialize();$.post("/ws/1/reaction/valider/",data,"json").done($.proxy(function(response){if(response.error===true&&response.message.length>0){$(".erreur",this).html(response.message).show();return}$(".erreur",
this).hide();$(".confirmation",this).show();require(["lmd/core/advert/ezakus"],function(ezakus){ezakus.trigger("reagir")})},this))});$(".modifier, .annuler",form).off("click");$(".modifier, .annuler",form).on("click",function(){$input=$("[name=signature]",form);$(".modifier, .annuler, .alerte",form).toggle();if(typeof $input.attr("readonly")!=="undefined"){$input.removeAttr("readonly");$input.val("").focus()}else{$input.attr("readonly","readonly");$input.val($input.data("default"))}});$(".confirmation",
this).off("click");$(".confirmation",form).on("click",".fermer",function(){$(this).closest(".confirmation").hide()});$(".regles_conduite",this).off("click");$(".regles_conduite",this).on("click",function(){$("ul",this).slideToggle();$(".fle_ferme,.fle_ouvert",this).toggleClass("fle_ouvert fle_ferme")})})},_initReagir:function(){var closure=this;$(".bt_reagir",this.$root).on("click",function(e){e.preventDefault();e.stopPropagation();closure.$localForm.detach();$(window).scrollTop(closure.$globalForm.offset().top-
20)})},_initRepondre:function(){var closure=this;$(".bt_repondre",this.$root).on("click",function(e){e.preventDefault();e.stopPropagation();if(this.$localForm!==null){var $item=$(this).closest(".reaction");closure.$localForm.insertAfter($item);closure.$localForm.find("[name=element_id]").val($item.data("reaction_id"));closure._initFormReaction()}})},_initAbonnezVous:function(){var closure=this;this.$root.find(".abo_link").on("click",function(event){event.preventDefault();event.stopPropagation();window.open("http://"+
conf.www.location.hostname+"/abo/?clef=BT_REAGIRBAS14","_blank")})},afficherNbRestant:function(root,selector,nombre){var message,suffixe="e";if(nombre>3)nombre=3;if(nombre===1)suffixe="re";message=nombre+"<sup>"+suffixe+"</sup>";$(selector,root).html(message)}};return reaction});

/* -- end module lmd/module/element/reaction -- */
/* -- start module lmd/module/auth/mini-login -- */
define("lmd/module/auth/mini-login",["jquery","lmd/core/conf","hoganpower!/partials/auth/mini-login.html.mu"],function($,conf,template){return{$el:null,render:function(){this.$el=$(template.render());this.$el.find(".oubli-mdp").on("click",function(e){e.preventDefault();e.stopPropagation()})}}});

/* -- end module lmd/module/auth/mini-login -- */
/* -- start module hgn/www/partials/auth/mini-login.html.mu.js@abs -- */
define("hgn/www/partials/auth/mini-login.html.mu.js@abs",function(){return function(c,p,i){var _=this;_.b(i=i||"");_.b("<form class=\"deja_abo txt3_120\" action=\"/teaser/\" method=\"post\">");_.b("\n" + i);_.b("   <span class=\"txt6\">Déjà abonné ?</span>");_.b("\n" + i);_.b("   <p><label class=\"block\">Adressse e-mail<br><input type=\"email\" name=\"login\" class=\"saisie\"></label></p>");_.b("\n" + i);_.b("   <p><label class=\"block\">Mot de passe<br><input type=\"password\" name=\"password\" class=\"saisie\"></label></p>");_.b("\n" + i);_.b("   <p><label class=\"txt1 en_ligne\"><input type=\"checkbox\" name=\"sauv_login\"> Rester connecté</label><a class=\"txt1 oubli-mdp\">Mot de passe oublié ?</a></p>");_.b("\n" + i);_.b("   <p><input type=\"submit\" class=\"btn\" value=\"S'identifier\"></p>");_.b("\n" + i);_.b("</form>");return _.fl();;}})
/* -- end module hgn/www/partials/auth/mini-login.html.mu.js@abs -- */
/* -- start module lmd/ui/lecture-zen -- */
define("lmd/ui/lecture-zen",["jquery","lmd/ui/lightbox","lmd/core/auth","lmd/module/element/toolbar","lmd/core/social/facebook","lib/require/plugin/domReady"],function($,Lightbox,auth,toolbar,facebook,domReady){var instance=null,config={id:null,el:".btn_lecture_zen",wrapper:".article_normal div#articleBody",elReaction:"p.reaction a, a.reagir.outil",listeReaction:".liste_reactions",topPos:75,bottomPos:25},myLightbox={overlay:".fond_overlay.lecture_zen",wrapper:".overlay.lecture_zen",button:".fermer_lecture_zen",top:0,
overlayClose:false,overlaySpeedIn:250,overlaySpeedout:250},ws="/ws/1/element/zen/",scrollTopPos=0,ScrollToReaction=false,singleton=function(){var LectureZen=function(){};LectureZen.prototype={init:function(params){var self=this;config=$.extend(config,params);if(config.id===undefined||config.envoyer===undefined||config.imprimer===undefined)throw new Error("Lecture zen : Attention, tous les param\u00e8tres doivent \u00eatre renseign\u00e9");if(config.id===null)throw new Error("Lecture zen : Un id d'item doit \u00eatre pass\u00e9 en param\u00e8tre lors de l'initialisation");
ws+=config.id+"/";self.create()},open:function(callback){var self=this;this.lightbox=new Lightbox(myLightbox);this.lightbox.setLoader(true);this.isOpen=true;$.getJSON(ws,null,"jsonp").done(function(data){self.lightbox.on("open",function(){self.fixSiblingsPositions(true);self.fixOverlayHeader(true);self.loadToolbar();self.loadXiti();self.loadEzakus();$(document).scrollTop(0);typeof callback==="function"&&callback()});self.lightbox.on("close",function(){self.close()});scrollTopPos=$(window).scrollTop();
ScrollToReaction=false;self.lightbox.open(data.content);$(config.elReaction).on("click",function(e){e.preventDefault();ScrollToReaction=true;self.lightbox.close()})}).fail(function(){self.lightbox.close();self.isOpen=false})},close:function(){this.fixSiblingsPositions(false);this.fixOverlayHeader(false);if(!ScrollToReaction)$(window).scrollTop(scrollTopPos);else $(window).scrollTop($(config.listeReaction).offset().top);this.isOpen=false},create:function(){var self=this;this.bouton=$("<div>").addClass(config.el.substr(1)).hide();
var i;$.getJSON(ws,null,"jsonp");$(config.wrapper).append(this.bouton);this.bouton.fadeIn("fast");this.isHide=false;$(config.wrapper+" p").each(function(index){if($.trim($(this).html())!==""){i=index;return false}});if(i!=null)this.limitTop=$(config.wrapper+" p:eq("+i+")").offset().top;this.limitBottom=this.limitTop+$(config.wrapper).height();this.isOpen=false;this.adjust();if(auth.authenticated)auth.loadUser().done(function(){if(auth.user.abonne===true)self.bouton.on("click",$.proxy(self.open,self))});
$(window).on("scroll",$.proxy(this.adjust,this))},adjust:function(){var bouton=$(config.el),position=$(window).scrollTop(),left=$(config.wrapper).parent().offset().left-55;if(!this.isOpen)if(position<=this.limitBottom-config.bottomPos){if(this.isHide){bouton.fadeIn("fast");this.isHide=false}if(position<=this.limitTop-config.topPos)bouton.css({top:this.limitTop-position,left:left});else bouton.css({top:config.topPos,left:left})}else{bouton.fadeOut("fast");this.isHide=true}},loadToolbar:function(){toolbar._options.envoyer=
config.envoyer;toolbar._options.imprimer=config.imprimer;toolbar.$el=$(myLightbox.wrapper);toolbar._initSharing();toolbar._initEnvoyer();toolbar._initImprimer();toolbar._initClasser();toolbar._initReagir();facebook.load().done(function(){facebook.parse({})});if(window.twttr!==undefined)twttr.widgets.load();$("article #publisher",$(myLightbox.wrapper)).text($("article #publisher").data("source"))},loadXiti:function(){if(auth.authenticated)auth.loadUser().done(function(){if(auth.user.abonne===true)if(window.xt_med!==
undefined&&lmd.context.page.xiti.xtn2!==undefined&&lmd.context.page.xiti.xtpage!==undefined&&lmd.context.page.xiti.xt_multc!==undefined)xt_med("F",lmd.context.page.xiti.xtn2,lmd.context.page.xiti.xtpage+lmd.context.page.xiti.xt_multc+"&x6=1","")})},loadEzakus:function(){require(["lmd/core/advert/ezakus"],function(ezakus){ezakus.trigger("zen")})},fixSiblingsPositions:function(action){var fix=action||false,$header=$("header");if(fix)$header.css({"position":"fixed","width":"100%"});else $header.css({"position":"relative"})},
fixOverlayHeader:function(action){var fix=action||false,$header=$(myLightbox.button);if(fix)$("body").append($header);else $header.remove()}};return{getInstance:function(){if(instance===null)instance=new LectureZen;return instance},getConfig:function(){return config}}}();return singleton});

/* -- end module lmd/ui/lecture-zen -- */