// Licensed Materials - Property of IBM, mc.js (Build # 4.11.124 Date/Time: 20131016-15:09), (C) Copyright IBM Corporation 2013. U.S. Government Users Restricted Rights:  Use, duplication or disclosure restricted by GSA ADP Schedule Contract with IBM Corp.
cmMarketing.SitePromotions=function(){this.cm_sp=function(a){return a?("DMC:"+a.campaignName+"-_-"+a.audienceName+((a.subSegmentName=="NO_SUBSEGMENT")?"":":"+a.subSegmentName)+"|"+a.splitName+"-_-"+a.communicationName):null};this.cm_mmca41=function(a){return a?a.runDateTimeStr:null};this.cm_mmca42=function(a){return a?(a.campaignId+"/"+a.audienceId+((a.subSegmentId=="NO_SUBSEGMENT")?"":":"+a.subSegmentId)+"|"+a.splitIdx+"-"+a.splitPct+"/"+a.communicationId+"/"+a.buildId+":"+a.runDateTime):null};this.isDef=function(a){return !(typeof(a)==="undefined"||a===null)};this.addParam=function(b,e,h){h+="";if(b){var g=b.indexOf("://");if(g!==-1){var d=b.indexOf("#");var c="";if(d!==-1){c=b.substring(d);b=b.substring(0,d)}var a=b.charAt(b.length-1);var f=a!="?"&&a!="&";var i=b.indexOf("?");g=b.indexOf("/",g+3);if(g===-1){b+="/"}a=(i===-1)?"?":"&";if(f){b+=a}b+=cE(e)+"="+cE(h);b+=c}}return b};this.register=function(f,h){var a=cmGetProtocol(null)+"//data.de.coremetrics.com/cm",c=this.addParam;a=c(a,"cm_sp",this.cm_sp(h));var j=new _cm("tid","9");var g=new _cmLink(cmCheckInPageAnchor(a));j.cm_sp=g.cm_sp;j.pi=cmGetPageID(j.ci);j.st=cm_ClientTS;j.cm_spa41=this.cm_mmca41(h);j.cm_spa42=this.cm_mmca42(h);if(typeof cmCheckIgnoreImpression==="function"){if(cmCheckIgnoreImpression(j.cm_sp,"","","")){j.write(1)}}else{j.write(1)}var c=this.addParam,a;var b=document.getElementById(f);if(b){if(b.tagName&&b.tagName.toUpperCase()=="A"){a=b.href;a=c(a,"cm_sp",this.cm_sp(h));a=c(a,"cm_spa41",this.cm_mmca41(h));a=c(a,"cm_spa42",this.cm_mmca42(h));b.href=a;cmAddNewEvent(b,"click",cmGetLink)}var e=b.getElementsByTagName("a");for(var d=0;d<e.length;d++){a=e[d].href;a=c(a,"cm_sp",this.cm_sp(h));a=c(a,"cm_spa41",this.cm_mmca41(h));a=c(a,"cm_spa42",this.cm_mmca42(h));e[d].href=a;cmAddNewEvent(e,"click",cmGetLink)}}}};cmMarketing.Cookie=function(f,c){var e=f;var b=c;var a={};var d="|";var i="_";var h="}^#";var g=["pageCount","onSiteSearchCount","orders","sales","itemsCartedCount","itemsPurchasedCount","productViewsCount","eventPoints","eventsCompletedCount","eventsInitiatedCount","elementsViewedCount","firstPageFlag","startTime","segmentConditionsMet","segmentsMet","referringSite","naturalSearchTerm","naturalSearchEngine","marketingCategory","marketingVendor","marketingProgram","newOrRepeatSession","entryPage","marketingPlacement","marketingItem","coremetricsGuid","marketingChannel","referringUrl"];this.write=function(){b.call(null,e,this.toString())};this.getEntryPage=function(){return this.getStringValue("entryPage")};this.setEntryPage=function(j){this.setStringValue("entryPage",this.coerceString(j))};this.getMarketingPlacement=function(){return this.getStringValue("marketingPlacement")};this.setMarketingPlacement=function(j){this.setStringValue("marketingPlacement",this.coerceString(j))};this.getMarketingItem=function(){return this.getStringValue("marketingItem")};this.setMarketingItem=function(j){this.setStringValue("marketingItem",this.coerceString(j))};this.getCoremetricsGuid=function(){return this.getStringValue("coremetricsGuid")};this.setCoremetricsGuid=function(j){this.setStringValue("coremetricsGuid",j)};this.getMarketingChannel=function(){return this.getStringValue("marketingChannel")};this.setMarketingChannel=function(j){this.setStringValue("marketingChannel",this.coerceString(j))};this.getReferringUrl=function(){return this.getStringValue("referringUrl")};this.setReferringUrl=function(j){this.setStringValue("referringUrl",this.coerceString(j,100))};this.getPageCount=function(){return this.getIntValue("pageCount")};this.setPageCount=function(j){this.setIntValue("pageCount",j)};this.getOnSiteSearchCount=function(){return this.getIntValue("onSiteSearchCount")};this.setOnSiteSearchCount=function(j){this.setIntValue("onSiteSearchCount",j)};this.getOrders=function(){return this.getIntValue("orders")};this.setOrders=function(j){this.setIntValue("orders",j)};this.getSales=function(){return this.getFloatValue("sales")};this.setSales=function(j){this.setFloatValue("sales",j)};this.getItemsCartedCount=function(){return this.getFloatValue("itemsCartedCount")};this.setItemsCartedCount=function(j){this.setFloatValue("itemsCartedCount",j)};this.getItemsPurchasedCount=function(){return this.getFloatValue("itemsPurchasedCount")};this.setItemsPurchasedCount=function(j){this.setFloatValue("itemsPurchasedCount",j)};this.getProductViewsCount=function(){return this.getIntValue("productViewsCount")};this.setProductViewsCount=function(j){this.setIntValue("productViewsCount",j)};this.getEventPoints=function(){return this.getFloatValue("eventPoints")};this.setEventPoints=function(j){this.setFloatValue("eventPoints",j)};this.getEventsCompletedCount=function(){return this.getIntValue("eventsCompletedCount")};this.setEventsCompletedCount=function(j){this.setIntValue("eventsCompletedCount",j)};this.getEventsInitiatedCount=function(){return this.getIntValue("eventsInitiatedCount")};this.setEventsInitiatedCount=function(j){this.setIntValue("eventsInitiatedCount",j)};this.getElementsViewedCount=function(){return this.getIntValue("elementsViewedCount")};this.setElementsViewedCount=function(j){this.setIntValue("elementsViewedCount",j)};this.getFirstPageFlag=function(){return this.getIntValue("firstPageFlag")};this.setFirstPageFlag=function(j){this.setIntValue("firstPageFlag",j)};this.isFirstPage=function(){return this.getFirstPageFlag()?false:true};this.getSessionStartTime=function(){return this.getIntValue("startTime")};this.setSessionStartTime=function(j){this.setIntValue("startTime",j)};this.getSegmentsMetArray=function(){var j=[];var m=this.getSegmentsMet();if(m===""){return j}var l=m.split(i);for(var n=0,k=l.length;n<k;n+=1){j[n]=l[n]}return j};this.setSegmentsMetArray=function(k){var m="";for(var l=0,j=k.length;l<j;l+=1){if(m.length>0){m+="_"}m+=k[l]}this.setSegmentsMet(m)};this.getSegmentsMet=function(){return this.getStringValue("segmentsMet")};this.setSegmentsMet=function(j){this.setStringValue("segmentsMet",j)};this.setNewSegmentMet=function(k){var j=this.getSegmentsMet();if(j.length>0){j+="_"}j+=k;this.setSegmentsMet(j)};this.setNewSegmentConditionMet=function(k){var j=this.getSegmentConditionsMet();if(j.length>0){j+="_"}j+=k;this.setSegmentConditionsMet(j)};this.getSegmentConditionsMetArray=function(){var j=[];var l=this.getSegmentConditionsMet();if(l===""){return j}var m=l.split(i);for(var k=0,n=m.length;k<n;k+=1){j[k]=m[k]}return j};this.setSegmentConditionsMetArray=function(m){var l="";for(var k=0,j=m.length;k<j;k+=1){if(l.length>0){l+="_"}l+=m[k]}this.setSegmentConditionsMet(l)};this.getSegmentConditionsMet=function(){return this.getStringValue("segmentConditionsMet")};this.setSegmentConditionsMet=function(j){this.setStringValue("segmentConditionsMet",j)};this.getNewOrRepeatSession=function(){return this.getStringValue("newOrRepeatSession")};this.setNewOrRepeatSession=function(j){this.setStringValue("newOrRepeatSession",j)};this.getMarketingProgram=function(){return this.getStringValue("marketingProgram")};this.setMarketingProgram=function(j){this.setStringValue("marketingProgram",this.coerceString(j))};this.getMarketingVendor=function(){return this.getStringValue("marketingVendor")};this.setMarketingVendor=function(j){this.setStringValue("marketingVendor",this.coerceString(j))};this.getMarketingCategory=function(){return this.getStringValue("marketingCategory")};this.setMarketingCategory=function(j){this.setStringValue("marketingCategory",this.coerceString(j))};this.getNaturalSearchEngine=function(){return this.getStringValue("naturalSearchEngine")};this.setNaturalSearchEngine=function(j){this.setStringValue("naturalSearchEngine",this.coerceString(j))};this.getNaturalSearchTerm=function(){return this.getStringValue("naturalSearchTerm")};this.setNaturalSearchTerm=function(j){this.setStringValue("naturalSearchTerm",this.coerceString(j))};this.getReferringSite=function(){return this.getStringValue("referringSite")};this.setReferringSite=function(j){this.setStringValue("referringSite",this.coerceString(j))};this.getIntValue=function(k){if(!a[k]){return 0}var j=parseInt(a[k]);return(j)?j:0};this.getFloatValue=function(k){if(!a[k]){return 0}var j=parseFloat(a[k]);return(j)?j:0};this.getStringValue=function(j){if(!a[j]){return""}polishedElement=a[j].replace(h,"|");return polishedElement};this.setIntValue=function(j,k){if(parseInt(k)||k===0){if(j){a[j]=k}}};this.setFloatValue=function(j,k){if(parseFloat(k)||k===0){if(j){a[j]=k.toFixed(2)}}};this.setStringValue=function(k,l){var j;if(k){if(l){j=l.replace("|",h)}else{j=""}a[k]=j}};this.coerceString=function(k,j){if(!j){j=30}if(k&&k.length>j){return k.substring(0,j)}else{return k}};this.toString=function(){var j="";for(var m=0,l=g.length;m<l;m+=1){var k=g[m];var n=0;if(a[k]){n=a[k]}else{n=""}if(m>0){j+=d}j+=n}return j};this.fromString=function(m){if(!m){return}var j=m.split(d);if(j.length!==g.length){cmMarketing.log("length of values does not match length of keys")}for(var l=0,k=g.length,n=j.length;l<k&&l<n;l+=1){a[g[l]]=j[l]}return this}};cmMarketing.Treater=function(c,a){var d=c;var b=a;this.applyTreatment=function(f,t,h,g,w,o){if(!f){return}var n;for(var p=0,u=f.replacements.length;p<u;p+=1){var e=f.replacements[p];if(e.matchFunction(t,h)){for(var l=0,r=e.elements.length;l<r;l+=1){var s=e.elements[l];if(s.hasOwnProperty("rules")){for(var m=0,q=s.rules.length;m<q;m+=1){var v=s.rules[m];if(v.criteria(g,w,o)){this.applyReplacement(s.targetId,v.type,v.attrs,g,w,o,function(){cmMarketing.INSTANCE.registerSP(s.targetId,v.spTracking)})}}}else{this.applyReplacement(s.targetId,s.type,s.attrs,g,w,o,function(){cmMarketing.INSTANCE.registerSP(s.targetId,s.spTracking)})}}}}};this.applyReplacement=function(o,r,l,j,t,n,h,f){var q=this;cmMarketing.log("Apply replacement to '"+o+"', type '"+r+"'");if(d[o]){cmMarketing.log("element '"+o+"' has already been treated");return}var i=o;var k=null;var s=i.split("[");if(s.length>1){i=s[0];k=s[1];k=k.substring(0,k.length-1)}var m=null,g=null;if(i!=null){m=a.getElementById(i)}if(m==null){if(typeof(f)==="undefined"){f=0}if(f<10){cmMarketing.log("Unable to apply replacement: "+i+" not found, checking again in 300ms");setTimeout(function(){f=f+1;q.applyReplacement(o,r,l,j,t,n,h,f)},300)}else{cmMarketing.log("Unable to apply replacement: "+i+" not found")}return}if(k!=null){var e=this.getChild(m,k);if(e==null){e=this.createDummyElement(r);if(e==null){cmMarketing.log("cannot create a child node for type"+r+", exiting");return}m.appendChild(e)}m=e}var p=this.createNewElement(r,l,j,t,n);if(p){p.id=m.id;d[o]=true;m.parentNode.replaceChild(p,m);h();return p}};this.getChild=function(k,g){if(g!=null&&k.hasChildNodes()){var j=k.childNodes;var f=-1;for(var h=0;h<j.length;h++){var l=j[h];if(l.nodeType!=3){f++}else{var e=l.nodeValue;if(e&&e.replace(/^\s*/,"").replace(/\s*$/,"")){f++}}if(f.toString()==g){return l}}}return null};this.createNewElement=function(l,i,g,m,j){var f;switch(l){case"PF_TEXT":f=b.createElement("span");var e=this.getPfValue(i.pfFieldType,i.pfField,i.pfKey,g,m,j);f.innerHTML=e;break;case"HTML":f=b.createElement("span");f.innerHTML=this.parseHtml(i.htmlSrc,g,m,j);break;case"IMAGE":f=b.createElement("img");f.src=i.src;break;case"HTML-LINK":f=b.createElement("a");f.innerHTML=this.parseHtml(i.htmlSrc,g,m,j);f.href=this.parseHtml(i.link,g,m,j);break;case"IMAGE-LINK":var k=b.createElement("img");for(var n in i){if(!n||typeof(n)!="string"){continue}if(!i[n]||i[n]==""||i[n].constructor==Function){continue}if(n.toUpperCase()=="LINK"){continue}var h=this.parseHtml(i[n],g,m,j);k.setAttribute(n,h)}f=b.createElement("a");f.href=this.parseHtml(i.link,g,m,j);f.appendChild(k);break;default:f=null}return f};this.getPfValue=function(h,f,g,e,k,j){var i="";if(h=="S"){if(f&&e&&typeof(e[f])!=="undefined"){i=e[f]}}else{if(h=="G"){if(f&&j){if(j[f.toUpperCase()]){i=j[f.toUpperCase()]}else{if(j[f]){i=j[f]}}}}else{if(h=="R"){if(f&&k){if(k[f.toUpperCase()]){i=k[f.toUpperCase()]}else{if(k[f]){i=k[f]}}}}else{if(h=="P"){i=this.getPromoCode(f,g,k)}}}}return i};this.parseHtml=function(i,e,h,g){var f=this;return i.replace(/\{\{mcpf\{([^,]*),([^},]*)(?:,([^}]*))?\}\}\}/g,function(j,n,k,l){return f.getPfValue(n,k,l,e,h,g)})};this.getPromoCode=function(e,h,j){var g="";var i=j[e];if(!h){return g}if(i){var f=i[h];if(typeof(f)==="undefined"){return g}else{return f}}return g};this.createDummyElement=function(f){var e;switch(f){case"PF_TEXT":e=b.createElement("span");break;case"HTML":e=b.createElement("span");break;case"IMAGE":e=b.createElement("img");break;case"HTML-LINK":e=b.createElement("a");break;case"IMAGE-LINK":e=b.createElement("img");break;default:e=null}return e}};cmMarketing.Topline=function(i,l,m,o){var n={PAGE_VIEW:1,ORDER:3,SHOP:4,PRODUCT_VIEW:5,TECH_PROPERTY:6,CONVERSION_EVENT:14,ELEMENT:15};var h=i;var e=l;var k=l.document;var g=o;var d=null;var f=m;this.pgct=h.getPageCount(),this.osshct=h.getOnSiteSearchCount(),this.orders=h.getOrders(),this.sales=h.getSales(),this.itcartct=h.getItemsCartedCount(),this.itpurct=h.getItemsPurchasedCount(),this.pvct=h.getProductViewsCount(),this.evpts=h.getEventPoints(),this.evcomct=h.getEventsCompletedCount(),this.evinict=h.getEventsInitiatedCount(),this.elvct=h.getElementsViewedCount(),this.startTime,this.slen;this.n_r=h.getNewOrRepeatSession(),this.mkchnl=h.getMarketingChannel(),this.mkpgm=h.getMarketingProgram(),this.mkv=h.getMarketingVendor(),this.mkc=h.getMarketingCategory(),this.mkp=h.getMarketingPlacement(),this.mki=h.getMarketingItem(),this.cmguid=h.getCoremetricsGuid(),this.natscheng=h.getNaturalSearchEngine(),this.natschtm=h.getNaturalSearchTerm(),this.refurl=h.getReferringUrl(),this.refsite=h.getReferringSite(),this.enpg=h.getEntryPage(),this.tzloc="";this.setRules=function(c){d=c};function j(r,p){if(!h){cmMarketing.log("calculateToplineInit(). cookie was not defined");return}r.startTime=h.getSessionStartTime()?h.getSessionStartTime():new Date().getTime()/1000;r.slen=Math.round(new Date().getTime()/1000-r.startTime);if(h.isFirstPage()){r.mkchnl=(new _cm_refurl()).DIRECT_LOAD_CHANNEL;if(p.hasOwnProperty("pn")){r.enpg=p.pn}else{if(p.hasOwnProperty("pi")){r.enpg=p.pi}else{r.enpg="UNKNOWN PAGE NAME"}}r.n_r=_cm_isNew?"NEW":"REPEAT";var t=k.referrer;var c=e.location.href;var q=g.parseVCPI(c)||g.parseVCPI(t);if(!q&&p&&p.hasOwnProperty("ul")){q=g.parseVCPI(p.ul)}var s=g.parseReferralURL(t);if(q&&q.length>0){r.mkchnl=s.MARKETING_PROGRAMS;r.mkpgm=q[0];r.mkv=q[1];r.mkc=q[2];r.mkp=q[3];r.mki=q[4];r.cmguid=q[5]}else{r.mkchnl=s.channel;r.mkpgm="";r.mkv="";r.mkc=""}r.refsite=s.refName;r.natscheng=s.natSearchEngine;r.natschtm=s.natSearchWord;r.refurl=t}r.tzloc=b()}function b(){var p=new Date(2009,0,15);var r=Math.floor(p.getTimezoneOffset()/60);var q={8:"LOS ANGELES",7:"DENVER",6:"CHICAGO",5:"NEW YORK"};var c="";if(q[r]){c=q[r]}return c}this.isOnSiteSearch=function(c){if(!c){return false}if(!(c.hasOwnProperty("se"))||c.se===null){return false}if(!c.se.replace(/^\s*/,"").replace(/\s*$/,"")){return false}return true};function a(p){var c=parseFloat(p);return(c===NaN)?0:c}this.getCookie=function(){return h};this.calculateTopline=function(c){j(this,c);if(!c.hasOwnProperty("tid")){return}if(typeof c.tid==="string"){c.tid=parseInt(c.tid)}if(c.tid!==n.PAGE_VIEW){if(c.tid===n.TECH_PROPERTY||c.hasOwnProperty("pc")){if((c.pc.indexOf("y")===0)||(c.pc.indexOf("Y")===0)){this.pgct+=1}if(this.isOnSiteSearch(c)){this.osshct+=1}}}if(c.tid===n.PAGE_VIEW){this.pgct+=1;if(this.isOnSiteSearch(c)){this.osshct+=1}}else{if(c.tid===n.ORDER){this.orders+=1;if(c.hasOwnProperty("tr")){this.sales+=a(c.tr)}}else{if(c.tid===n.SHOP){if(c.hasOwnProperty("at")&&c.at==="5"&&c.hasOwnProperty("qt")&&a(c.qt)){this.itcartct+=a(c.qt)}if(c.hasOwnProperty("at")&&c.at==="9"&&c.hasOwnProperty("qt")&&a(c.qt)){this.itpurct+=a(c.qt)}}else{if(c.tid===n.PRODUCT_VIEW){this.pvct+=1}else{if(c.tid===n.CONVERSION_EVENT){if(c.hasOwnProperty("cpt")&&a(c.cpt)){this.evpts+=a(c.cpt)}if(c.hasOwnProperty("cat")&&a(c.cat)===2){this.evcomct+=1}if(c.hasOwnProperty("cat")&&a(c.cat)===1){this.evinict+=1}}else{if(c.tid===n.ELEMENT){this.elvct+=1}}}}}}h.setPageCount(this.pgct);h.setOnSiteSearchCount(this.osshct);h.setOrders(this.orders);h.setSales(this.sales);h.setItemsCartedCount(this.itcartct);h.setItemsPurchasedCount(this.itpurct);h.setProductViewsCount(this.pvct);h.setEventPoints(this.evpts);h.setEventsCompletedCount(this.evcomct);h.setEventsInitiatedCount(this.evinict);h.setElementsViewedCount(this.elvct);h.setSessionStartTime(this.startTime);if(h.isFirstPage()){h.setNewOrRepeatSession(this.n_r);h.setReferringSite(this.refsite);h.setNaturalSearchTerm(this.natschtm);h.setNaturalSearchEngine(this.natscheng);h.setMarketingVendor(this.mkv);h.setMarketingCategory(this.mkc);h.setMarketingProgram(this.mkpgm);h.setSegmentConditionsMetArray([]);h.setSegmentsMetArray([]);h.setEntryPage(this.enpg);h.setMarketingPlacement(this.mkp);h.setMarketingItem(this.mki);h.setCoremetricsGuid(this.cmguid);h.setMarketingChannel(this.mkchnl);h.setReferringUrl(this.refurl)}h.setFirstPageFlag(1);h.write()};this.syncTechnicalProperties=function(c){if(c.tid===n.TECH_PROPERTY){if(typeof c.tz!=="undefined"){c.tz=c.tz.toString()}if(typeof c.pd!=="undefined"){c.pd=c.pd.toString()}}else{var p=coremetrics.getTechProps();if(typeof p.tz!=="undefined"){c.tz=p.tz.toString()}else{c.tz=""}if(typeof p.pd!=="undefined"){c.pd=p.pd.toString()}else{c.pd=""}if(typeof p.jv!=="undefined"){c.jv=p.jv}else{c.jv=""}if(typeof p.sw!=="undefined"){c.sw=p.sw}else{c.sw=""}if(typeof p.sh!=="undefined"){c.sh=p.sh}else{c.sh=""}}};this.isItemInArray=function(c,r){for(var p=0,q=c.length;p<q;p+=1){if(r===c[p]){return true}}return false};this.calculateRealTimeSegmentConditionsMet=function(p,s){var c=h.getSegmentConditionsMetArray();if(!d){return c}for(var r=0,q=d.realTimeSegmentConditions.length;r<q;r+=1){var t=d.realTimeSegmentConditions[r];if(t.criteria(p,this,s)){if(!this.isItemInArray(c,t.id)){c.push(t.id)}}}h.setSegmentConditionsMetArray(c);h.write();cmMarketing.log("Cookie: "+h.toString());return c};this.getRealTimeSegmentConditionsMetArray=function(){return h.getSegmentConditionsMetArray()};this.calculateRealTimeSegmentsMet=function(){var c=h.getSegmentsMetArray();if(!d){return c}for(var q=0,p=d.realTimeSegments.length;q<p;q+=1){var s=d.realTimeSegments[q];var r=s.criteria();if(r){if(!this.isItemInArray(c,s.id)){c.push(s.id)}}}h.setSegmentsMetArray(c);h.write();cmMarketing.log("Cookie: "+h.toString());return c};this.getRealTimeSegmentsMetArray=function(){return h.getSegmentsMetArray()}};cmMarketing.segmentMatch=function(a){return cmMarketing.INSTANCE.isSegmentMet(a)};cmMarketing.inSplit=function(b,a){if(typeof(a)=="undefined"){return cmMarketing.INSTANCE.isInSplit(b)}else{return cmMarketing.INSTANCE.isInBetweenSplitFractions(b,a)}};cmMarketing.conditionMet=function(a){return cmMarketing.INSTANCE.isConditionMet(a)};cmMarketing.personalizationField=function(c,a){var b=cmMarketing.INSTANCE.getPersonalizationField(c);return(b)?b:a};cmMarketing.attachOnLoad=function(){if(document.addEventListener){document.addEventListener("DOMContentLoaded",cmMarketing.onLoad,false);window.addEventListener("load",cmMarketing.onLoad,false)}else{if(document.attachEvent){if(document.readyState=="complete"){cmMarketing.onLoad()}document.attachEvent("onreadystatechange",cmMarketing.onLoad);window.attachEvent("onload",cmMarketing.onLoad)}}};cmMarketing.onLoadCalled=false;cmMarketing.onLoad=function(){cmMarketing.log("cmMarketing.onLoad() called");if(!cmMarketing.onLoadCalled){cmMarketing.onLoadCalled=true}_cmMc.readyToCall.applyTreatment=true;if(_cmMc.callPending.applyTreatment){cmMarketing.INSTANCE.applyQueuedTreatments();_cmMc.callPending.applyTreatment=false}};cmMarketing.isInCampaignDesignUI=function(){var a=false;try{if(cmMarketing.isWindowNameMaxDepth("MC_WSP_PREVIEW",5)){a=true}}catch(b){}try{if(cmMarketing.isWindowNameMaxDepth("MC_WSP_COMM_EDITOR",5)){a=true}}catch(b){}return a};cmMarketing.isWindowNameMaxDepth=function(a,e){if(!e){e=1}var b=false;var d=0;var c=window;while(c!=null&&d<=e){if(c.name==a){b=true;break}c=c.parent;d++}return b};cmMarketing.MC=function(x,u,k,z,B,g,e,l,r,p,n){var b=x;var J=u;var o=k;var h=z;var D=B;var y=g;var j=e;var G=l;var I=r;var i=null;var w=false;var d=[];var H=null;var t=false;var A=false;var N={};var L={};var F={};var s={};var K=[];var m=p;var c=n;var f="",q="";var a=[];var M=["clientId","version","requiredPersonalizationFields","pageMatches","campaignDetails","realTimeSegmentConditions","realTimeSegments","treatments"];var C=["splitValues","pfMap"];var v=["treatmentId","replacements"];this.registerSP=function(O,P){c.register(O,P)};this.loadRules=function(){var R=false;try{if((_cmMc.getIframeMaxDepth("IMODGUIDIDENTIFIER",5)!=null)&&(window.name!=null)&&(window.name.length>0)){R=true}}catch(S){}if(R){return}var Q=cmMarketing.isInCampaignDesignUI();if(Q){var P=B.MC_APP_SERVER_HOST;if(P=="dmc.coremetrics.com"){P="https://mc.de.coremetrics.com"}if(P.indexOf("//")<0){P=cmGetProtocol(null)+"//"+P}var O=P+"/mcwebapp/testpreview.do?method=getWSPContentRules";cmMarketing.log("Loading rules: "+O);h.call(null,O)}else{var O=o.apply(null)+"//"+B.MC_RULES_HOST+"/"+J+"/JS/rules-"+J+".js";cmMarketing.log("Loading rules: "+O);h.call(null,O)}};this.onRulesLoaded=function(O){if(!this.validateJson(O,M)){cmMarketing.log("rules failed validation");return}i=O;w=true;y.setRules(O);if(G.tagCallTriggered){this.tagCallTriggered()}while(d.length>0){this.applyRules(d.shift())}j.applyRules=true};this.tagCallTriggered=function(){while(I.length>0){var O=I.shift();cmMarketing.log("dequeued from global queue, tag tid: '"+O.tid+"'");if(O.tid=="8"||O.tid=="9"||O.tid=="10"){cmMarketing.log("ignoring tag with tid: '"+O.tid+"'");continue}if(j.applyRules){this.applyRules(O)}else{d.push(O)}}};this.applyRules=function(O){this.processTag(O);a.push(O);if(!this.isUserDetailsLoadingOrLoaded()){cmMarketing.log("loadUserDetails()");this.loadUserDetails();G.applyUserDetails=true}else{if(j.applyUserDetails){this.applyUserDetails()}else{G.applyUserDetails=true}}};this.loadUserDetails=function(){var R=cmMarketing.isInCampaignDesignUI();if(R){cmMarketing.log("loading user details");t=true;var Q=B.MC_APP_SERVER_HOST;if(Q=="dmc.coremetrics.com"){Q="https://mc.de.coremetrics.com"}if(Q.indexOf("//")<0){Q=cmGetProtocol(null)+"//"+Q}var P=Q+"/mcwebapp/testpreview.do?method=getWSPContentUserDetails";h.call(null,P)}else{cmMarketing.log("loading user details");var O=false;if(i&&i.requiredGeoPersonalizationFields&&i.requiredGeoPersonalizationFields.length>0){O=true}t=true;var P=o.apply(null)+"//"+D.MC_USER_DETAILS_HOST+"/getData?COOKIEID="+b+"&CLIENTID="+J;O=true;if(O){P+="&GEODATA=1"}h.call(null,P)}};this.onUserDetailsLoaded=function(O){if(!this.validateJson(O,C)){cmMarketing.log("user details failed validation");return}H=O;A=true;t=false;j.applyUserDetails=true;if(G.applyUserDetails){G.applyUserDetails=false;this.applyUserDetails()}};this.applyUserDetails=function(){var Z=[];while(a.length>0){var aa=a.shift();y.calculateRealTimeSegmentConditionsMet(aa,(H&&H.geo)?H.geo:{})}if(!this.isPersonalizationRequired()){return}y.calculateRealTimeSegmentsMet();if(!i){cmMarketing.log("Rules not set while calling applyUserDetails - exiting");return}var W=this.getMatchingCampaigns();for(var U=0,T=i.campaignDetails.length;U<T;U+=1){var Q=i.campaignDetails[U];var X=false;for(var R=0;R<W.length;R++){if(W[R]==Q.campaignId){X=true;break}}if(X){var V=false;if(Q.hasMultipleAudience==="false"){Q.hasMultipleAudience=false}else{Q.hasMultipleAudience=true}if(Q.hasMultipleAudience){V=true}for(var S=0,O=Q.audiences.length;S<O;S+=1){var P=Q.audiences[S];var Y=this.evaluateAudience(P,V);if(Y.length>0){Z=Z.concat(Y);if(!V){break}}}}}this.loadTreatments(Z)};this.loadTreatments=function(S){cmMarketing.log("loading '"+S.length+"' treatments");if(this.isEmptyObject(i.treatments)){cmMarketing.log(" rules have no treatment. None will be applied")}for(var R=0,Q=S.length;R<Q;R+=1){var O=S[R];if(N[O]){cmMarketing.log("Skipping load of treatment '"+O+"'");continue}var P=i.treatments[O];if(P){cmMarketing.log("loading treatment id: "+O+", url: "+i.treatments[O]);F[O]=true;s[O]=false;L[O]=S;h.call(null,P)}}};this.onTreatmentLoaded=function(O){if(!this.validateJson(O,v)){cmMarketing.log("treatment "+O.treatmentId+" failed validation");return}cmMarketing.log("treatment '"+O.treatmentId+"' loaded");F[O.treatmentId]=false;N[O.treatmentId]=O;var P=this.isTreatmentReadyToBeApplied(O.treatmentId);cmMarketing.log("apply treatment '"+O.treatmentId+"'? "+P);if(P&&j.applyTreatment){this.applyTreatments(O)}else{G.applyTreatment=true;K.push(O)}};this.applyTreatments=function(O){this.applyQueuedTreatments();G.applyTreatment=false;this.applyTreatment(O);this.applyQueuedTreatments()};this.applyQueuedTreatments=function(){var O=true;while(O){O=false;var Q=[];while(K.length>0){var P=K.shift();if(this.isTreatmentReadyToBeApplied(P.treatmentId)){this.applyTreatment(P);O=true}else{Q.push(P)}}if(Q.length>0){K=K.concat(Q)}}};this.applyTreatment=function(O){s[O.treatmentId]=true;var P={};if(H&&H.pfMap){P=H.pfMap}var Q=P;if(H&&H.geo){Q=H.geo}m.applyTreatment(O,f,q,y,P,Q)};this.isTreatmentReadyToBeApplied=function(P){var O=true;var T=L[P];for(var R=0,Q=T.length;R<Q;R+=1){var S=T[R];if(S===P){return O}else{if(!this.isTreatmentAlreadyApplied(S)){O=false}}}return O};this.isTreatmentAlreadyApplied=function(O){return s[O]};this.evaluateAudience=function E(Q,T){var O=[];if(Q.criteria()){if(Q.hasOwnProperty("treatmentId")){if(T||(O.length===0)){O.push(Q.treatmentId)}}else{if(Q.hasOwnProperty("treatmentIds")){if(T||(O.length===0)){for(var R=0;R<Q.treatmentIds.length;R+=1){O.push(Q.treatmentIds[R])}}}else{for(var R=0,S=Q.subgroups.length;R<S;R+=1){var P=this.evaluateAudience(Q.subgroups[R],T);if(T||(O.length===0)){O=O.concat(P)}if(P&&P.length>0){break}}}}}return O};this.isUserDetailsLoadingOrLoaded=function(){if(typeof(A)=="undefined"){return false}if(typeof(t)=="undefined"){return false}return A||t};this.isPersonalizationRequired=function(){if(!i){return}for(var P=0,O=i.pageMatches.length;P<O;P+=1){if(i.pageMatches[P].getCampaignId(f,q)!=0){return true}}return false};this.getMatchingCampaigns=function(){cmMarketing.log("getMatch() called");var O=[];if(!i){return O}for(var Q=0,P=i.pageMatches.length;Q<P;Q+=1){var R=i.pageMatches[Q].getCampaignId(f,q);if(R&&R!=0){O.push(R.toString())}}return O};this.validateJson=function(R,Q){for(var P=0,O=Q.length;P<O;P+=1){if(!R.hasOwnProperty(Q[P])){return false}}return true};this.processTag=function(O){cmMarketing.log("processTag(), tid: '"+O.tid+"'");if(O){if(O.hasOwnProperty("ul")&&O.ul){f=O.ul}if(O.hasOwnProperty("pi")&&O.pi){q=O.pi}}y.calculateTopline(O);y.syncTechnicalProperties(O)};this.isConditionMet=function(O){var P=y.getRealTimeSegmentConditionsMetArray();return y.isItemInArray(P,O)};this.isSegmentMet=function(Q){var R=H.segments.concat(y.getRealTimeSegmentsMetArray());for(var P=0,O=R.length;P<O;P+=1){if(Q===R[P]){return true}}return false};this.isInSplit=function(O){return H.splitValues<O};this.isInBetweenSplitFractions=function(P,O){return H.splitValues>=P&&H.splitValues<O};this.getPersonalizationField=function(O){return H.pfMap[O]};this.setTreatmentQueue=function(O){K=O};this.setTreatmentPriorityMap=function(O){L=O};this.setTreatmentLoadingMap=function(O){F=O};this.setTreatmentAppliedMap=function(O){s=O};this.getTreatments=function(){return N};this.getTreatmentPriorityMap=function(){return L};this.getTreatmentLoadingMap=function(){return F};this.getLocalTagQueue=function(){return d};this.getRules=function(){return i};this.setRules=function(O){i=O};this.isRulesLoaded=function(){return w};this.isUserDetailsLoading=function(){return t};this.isUserDetailsLoaded=function(){return A};this.getUserDetails=function(){return H};this.isEmptyObject=function(O){if(typeof(O)=="undefined"){return true}if(!O){return true}for(var P in O){if(O.hasOwnProperty(P)){return false}}return true}};cmMarketing.log=function(a){if(typeof(window.console)!=="undefined"){console.log(a)}};function cmMcLoadRules(b){if(cmMarketing.INSTANCE!=null){return}if(!b){b=""}if(b.indexOf("&")!=-1){b=b.substring(0,b.indexOf("&"))}var c=new cmMarketing.Cookie(cmMarketing.COOKIE_NAME,cmSetCookie);c.fromString(cmGetCookie(cmMarketing.COOKIE_NAME));var a=new cmMarketing.Topline(c,window,_cm,_cmPartnerUtils);var d=new cmMarketing.Treater({},document);var e=new cmMarketing.SitePromotions();cmMarketing.INSTANCE=new cmMarketing.MC(b,cm_McClientID,cmGetProtocol,_cmPartnerUtils.loadScript,{MC_RULES_HOST:cm_MC_RULES_HOST,MC_USER_DETAILS_HOST:cm_MC_USER_DETAILS_HOST,MC_APP_SERVER_HOST:cm_MC_APP_SERVER_HOST},a,_cmMc.readyToCall,_cmMc.callPending,_cmMc.mcTagQueue,d,e);cmMarketing.attachOnLoad();cmMarketing.INSTANCE.loadRules()}_cmMc.getIframeMaxDepth=function(b,f){var e=parent;var a=null;var d=1;while(a==null&&e!=null&&(f==null||d<=f)){a=e.frames[b];var c=e;e=e.parent;if(e==c){e=null}d++}return a};(function(){var a=window;var b={cmGetCookie:"cI",cmSetCookie:"CB",cmGetProtocol:"C8",cmCheckInPageAnchor:"CP",cmGetPageID:"c1",_cmLink:"CM",cmGetLink:"cW",_cm_refurl:"Crur"};for(var c in b){if(b.hasOwnProperty(c)&&typeof(a[b[c]])=="function"){a[c]=a[b[c]]}}})();if(typeof cmUnitTest==="undefined"&&!cmMarketing.loaded){(function(){try{var a=false;try{if((_cmMc.getIframeMaxDepth("MCWSPGUIDIDENTIFIER",5)!=null)&&(window.name!=null)&&(window.name.length>0)){a=true}}catch(b){cmMarketing.log("Error checking for commeditor - nonfatal")}if(a){if(cm_MC_APP_SERVER_HOST=="dmc.coremetrics.com"){cm_MC_APP_SERVER_HOST="https://mc.de.coremetrics.com"}if(cm_MC_APP_SERVER_HOST.indexOf("//")<0){cm_MC_APP_SERVER_HOST=cmGetProtocol(null)+"//"+cm_MC_APP_SERVER_HOST}_cmPartnerUtils.loadScript(cm_MC_APP_SERVER_HOST+"/mcwebapp/js/json2.js");_cmPartnerUtils.loadScript(cm_MC_APP_SERVER_HOST+"/mcwebapp/js/easyXDM.js");_cmPartnerUtils.loadScript(cm_MC_APP_SERVER_HOST+"/mcwebapp/js/imodWebDesigner.js")}else{if(cm_JSFEnabled){cmMcLoadRules(cmGetCookie(cm_JSFCoreCookieName))}else{_cmPartnerUtils.loadScript(cmGetProtocol(null)+"//"+cm_HOST.substring(0,cm_HOST.indexOf("/"))+"/cookie-id.js?fn=cmMcLoadRules")}}}catch(b){cmMarketing.log("Error loading MC: "+b)}}());cmMarketing.loaded=true};
